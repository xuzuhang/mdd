(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mystate/release"],{"195d3":function(t,e,a){"use strict";var o=a("eb0f"),n=a.n(o);n.a},"3f59":function(t,e,a){"use strict";a.r(e);var o=a("d823"),n=a.n(o);for(var s in o)"default"!==s&&function(t){a.d(e,t,function(){return o[t]})}(s);e["default"]=n.a},"86a2":function(t,e,a){"use strict";var o=function(){var t=this,e=t.$createElement;t._self._c},n=[];a.d(e,"a",function(){return o}),a.d(e,"b",function(){return n})},c440:function(t,e,a){"use strict";(function(t){a("30b7"),a("921b");o(a("66fd"));var e=o(a("e7a0"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},d823:function(t,e,a){"use strict";(function(t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(a("ef4f"));function s(t){return t&&t.__esModule?t:{default:t}}var i=function(){return a.e("pages/components/cpimg/cpimg").then(a.bind(null,"6b9a"))},r=function(){return a.e("pages/components/compress").then(a.bind(null,"8d53"))},c={onLoad:function(){var e=this;t.getSystemInfo({success:function(t){e.model=t.platform}})},onReady:function(){this.getOnloadLaction()},components:{cpimg:i,compress:r},data:function(){return{imageW:1e3,imageH:1920,aa:"",midImage:[],model:"ios",count:9,imgArray:[],obj:{title:"",contents:"",photos:[],longitude:0,latitude:0}}},methods:{sures:function(){if(this.obj.contents||this.imgArray.length){for(var e=[],a=0;a<this.imgArray.length;a++)e.push(this.imgArray[a].key);this.obj.photos=e,this.$myhttp.post(this.websiteUrl+"/news",this.obj,function(e){0==e.data.code?(t.showToast({icon:"success",title:"发布成功"}),setTimeout(function(){t.navigateBack({delta:1})},1e3)):t.showToast({icon:"none",title:e.data.message})},this)}else t.showToast({icon:"none",title:"图片或文字至少传一个哦"})},getOnloadLaction:function(){var e=this;t.getLocation({type:"gcj02",success:function(t){e.obj.longitude=t.longitude,e.obj.latitude=t.latitude},fail:function(){e.$myhttp.get(e.websiteUrl+"/users","",function(t){t.data.data.areaId;var a=(0,n.default)(t.data.data.areaId),o=a.replace(/-/g,"");e.$myhttp.get(e.websiteUrl+"/geocoder/latlng?address="+encodeURIComponent(o),"",function(t){e.obj.longitude=t.data.location.lng,e.obj.latitude=t.data.location.lat},e)},e)}})},showImg:function(e){this.throttle||t.previewImage({current:0,urls:[e],success:function(t){console.log(o(t," at pages/mystate/release.vue:137"))},fail:function(t){console.log(o(t," at pages/mystate/release.vue:140"))}})},remove:function(e){var a=this;this.throttle||t.showModal({title:"提示",content:"确定要删除么",success:function(t){t.confirm?(a.imgArray.splice(e,1),a.count++):t.cancel&&console.log(o("用户点击取消"," at pages/mystate/release.vue:156"))}})},upload:function(e,a){t.uploadFile({url:"https://openapi.hm8848.com/news/photos",filePath:e,name:"file",header:{authorization:this.$store.state.token},success:function(t){a(t)},fail:function(e){t.showToast({icon:"none",title:"上传失败"})}})},addPhoto:function(){var e=this;this.throttle||(plus.key.hideSoftKeybord(),this.throttle=!0,t.showActionSheet({itemList:["拍摄","从手机相册中选择"],success:function(a){console.log(o(a.tapIndex," at pages/mystate/release.vue:195")),0==a.tapIndex?t.chooseImage({sizeType:["original"],sourceType:["camera"],success:function(a){console.log(o(a," at pages/mystate/release.vue:201")),e.midImage=e.imgArray,t.getImageInfo({src:a.tempFilePaths[0],success:function(a){var o=0;if("ios"==e.model)o=0;else switch(a.orientation){case"up":o=0;break;case"down":o=180;break;case"right":o=90;break;case"left":o=270;break;default:o=0;break}plus.zip.compressImage({src:a.path,dst:"_doc/uniapp_temp/compressed/"+Math.round(new Date)+".jpg",format:"jpg",quality:90,rotate:o},function(a){t.showLoading({title:"上传中"});var o=a.target;e.upload(o,function(a){var o=JSON.parse(a.data);0==o.code?(e.imgArray.push(o.data),t.hideLoading(),e.throttle=!1,e.count=9-e.imgArray.length):(e.imgArray=e.midImage,e.throttle=!1,t.hideLoading(),t.showToast({icon:"none",title:o.message}))})})}})},fail:function(t){console.log(o(t," at pages/mystate/release.vue:270")),e.throttle=!1}}):1==a.tapIndex&&(console.log(o(111," at pages/mystate/release.vue:275")),t.chooseImage({count:e.count,sizeType:["original"],sourceType:["album"],success:function(a){console.log(o(a," at pages/mystate/release.vue:281")),e.midImage=e.imgArray,e.$refs.compress.yasuoImg(a.tempFilePaths).then(function(a){var n=a.map(function(t,e){return{uri:t.tempFilePath}});console.log(o(JSON.stringify(n)," at pages/mystate/release.vue:300"));var s=0,i=0,r="";t.showLoading({title:"上传中"});for(var c=0;c<n.length;c++)s++,e.upload(n[c].uri,function(a){var c=JSON.parse(a.data);0==c.code?(e.imgArray.push(c.data),s==n.length&&(i?(console.log(o(111," at pages/mystate/release.vue:319")),t.hideLoading(),t.showToast({icon:"none",title:r}),e.throttle=!1,e.imgArray=e.midImage,e.count=9-e.imgArray.length):(t.hideLoading(),e.throttle=!1,e.count=9-e.imgArray.length))):(i++,r=c.message,console.log(o(s,n.length," at pages/mystate/release.vue:338")),s==n.length&&i&&(t.hideLoading(),t.showToast({icon:"none",title:r}),e.throttle=!1,e.imgArray=e.midImage,e.count=9-e.imgArray.length))})})},fail:function(){e.throttle=!1}}))},fail:function(t){e.throttle=!1}}))},cpimgOk:function(e){var a=this,o=0;t.showLoading({title:"上传中"});for(var n=0;n<e.length;n++)o++,this.upload(e[n],function(n){var s=JSON.parse(n.data).data;a.imgArray.push(s),o==e.length&&(t.hideLoading(),a.throttle=!1,a.count=9-a.imgArray.length)})},cpimgErr:function(t){this.throttle=!1}}};e.default=c}).call(this,a("6e42")["default"],a("0de9")["default"])},e7a0:function(t,e,a){"use strict";a.r(e);var o=a("86a2"),n=a("3f59");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);a("195d3");var i=a("2877"),r=Object(i["a"])(n["default"],o["a"],o["b"],!1,null,null,null);e["default"]=r.exports},eb0f:function(t,e,a){}},[["c440","common/runtime","common/vendor"]]]);