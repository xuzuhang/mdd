(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/wantBuy/index"],{"16d8":function(t,e,i){"use strict";i.r(e);var a=i("4d40"),o=i("75e1");for(var n in o)"default"!==n&&function(t){i.d(e,t,function(){return o[t]})}(n);i("f784");var s=i("2877"),r=Object(s["a"])(o["default"],a["a"],a["b"],!1,null,null,null);e["default"]=r.exports},"4d40":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},o=[];i.d(e,"a",function(){return a}),i.d(e,"b",function(){return o})},"70ef":function(t,e,i){"use strict";(function(t,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i("90c6"),n=u(i("4efa")),s=u(i("1101")),r=u(i("6372")),c=u(i("ef4f"));function u(t){return t&&t.__esModule?t:{default:t}}var d=function(){return i.e("pages/components/compress").then(i.bind(null,"8d53"))},l=function(){return Promise.all([i.e("common/vendor"),i.e("pages/components/pickallcity")]).then(i.bind(null,"0464"))},h=function(){return Promise.all([i.e("common/vendor"),i.e("pages/components/pickcity")]).then(i.bind(null,"f703"))},f=function(){return i.e("pages/components/cpimg/cpimg").then(i.bind(null,"6b9a"))},p={onBackPress:function(){var e=this;return this.backPress&&t.showModal({title:"确认退出吗？编辑的内容不会被保存",content:" ",cancelText:"确定",confirmText:"取消",success:function(i){i.confirm||(e.backPress=!1,t.navigateBack({delta:1}))}}),this.backPress},components:{mpvueCityPicker:l,myCityPicker:h,cpimg:f,compress:d},onLoad:function(e){var i=this;t.getSystemInfo({success:function(t){i.model=t.platform}}),this.info=JSON.parse(e.info),this.getspecisure(),this.newdate(),this.obj.categoryId=this.info.id;for(var a=0;a<o.areas.length;a++)this.areas[o.areas[a].id]=o.areas[a],this.cityname[o.areas[a].name]=o.areas[a]},onShow:function(){var t=getCurrentPages(),e=t[t.length-1];e.data.objloc&&(this.obj.latitude=e.data.objloc.latitude,this.obj.longitude=e.data.objloc.longitude,this.obj.address=e.data.objloc.address,e.setData({objloc:""})),e.data.specifica&&(this.obj.requirePrice=e.data.specifica.requirePrice,this.obj.requirePhotos=e.data.specifica.requirePhotos,this.obj.payTerm=e.data.specifica.payTerm,this.obj.specifications=e.data.specifica.val,this.specificationsVal=e.data.specifica.texts,console.log(a(e.data.specifica," at pages/wantBuy/index.vue:204")),e.setData({specifica:""}))},onReady:function(){this.getOnloadLaction()},data:function(){return{midImage:[],model:"ios",count:9,backPress:!0,valueDate:"",startDate:"",endDate:"",city:"",specificationsVal:"",isSpecifications:!1,SpecificationsArr:"",obj:{categoryId:0,minPrice:"",maxPrice:"",payTerm:"",quantity:"",profile:"",acceptedAreas:[],longitude:0,latitude:0,areaId:"",address:"",photos:[],specifications:"",requirePrice:!1,requirePhotos:!1,expires:""},areas:{},cityname:{},purIndex:1,purchaseList:[{name:"请选择地区(最多3个)",id:""}],info:{},imgArray:[],areapickDefault:[0,0,0],cityPickerValueDefault:[0,0,0],themeColor:"#007AFF",mode:"",deepLength:1}},methods:{changeInput:function(t,e){this.obj[t]=e.target.value},bindDateChange:function(t){this.obj.expires=t.target.value},newdate:function(){var t=new Date,e=t.getTime()+6048e5,i=t.getTime()+864e5,a=t.getTime()+15552e6,o=new Date(e),n=new Date(i),s=new Date(a);this.valueDate=o.getFullYear()+"-"+this.addzero(o.getMonth()+1)+"-"+this.addzero(o.getDate()),this.startDate=n.getFullYear()+"-"+this.addzero(n.getMonth()+1)+"-"+this.addzero(n.getDate()),this.endDate=s.getFullYear()+"-"+this.addzero(s.getMonth()+1)+"-"+this.addzero(s.getDate()),this.obj.expires=this.valueDate},addzero:function(t){return t=t>9?t:"0"+t,t},upload:function(e,i){t.uploadFile({url:"https://openapi.hm8848.com/purchases/photos",filePath:e,name:"file",header:{authorization:this.$store.state.token},success:function(t){i(t)},fail:function(e){console.log(a(e," at pages/wantBuy/index.vue:302")),t.showToast({icon:"none",title:"上传失败"})}})},addPhoto:function(){var e=this;this.throttle||(plus.key.hideSoftKeybord(),this.throttle=!0,t.showActionSheet({itemList:["拍摄","从手机相册中选择"],success:function(i){0==i.tapIndex?t.chooseImage({sizeType:["original"],sourceType:["camera"],success:function(i){e.midImage=e.imgArray,t.getImageInfo({src:i.tempFilePaths[0],success:function(i){var a=0;if("ios"==e.model)a=0;else switch(i.orientation){case"up":a=0;break;case"down":a=180;break;case"right":a=90;break;case"left":a=270;break;default:a=0;break}plus.zip.compressImage({src:i.path,dst:"_doc/uniapp_temp/compressed/"+Math.round(new Date)+".jpg",format:"jpg",quality:90,rotate:a},function(i){t.showLoading({title:"上传中"});var a=i.target;e.upload(a,function(i){var a=JSON.parse(i.data);0==a.code?(e.imgArray.push(a.data),t.hideLoading(),e.throttle=!1,e.count=9-e.imgArray.length):(e.imgArray=e.midImage,e.throttle=!1,t.hideLoading(),t.showToast({icon:"none",title:a.message}))})})}})},fail:function(){e.throttle=!1}}):1==i.tapIndex&&(console.log(a("进入选照片"," at pages/wantBuy/index.vue:400")),t.chooseImage({count:e.count,sizeType:["original"],sourceType:["album"],success:function(i){e.midImage=e.imgArray,console.log(a(e.midImage," at pages/wantBuy/index.vue:407")),e.$refs.compress.yasuoImg(i.tempFilePaths).then(function(i){var o=i.map(function(t,e){return{uri:t.tempFilePath}}),n=0,s=0,r="";t.showLoading({title:"上传中"});for(var c=0;c<o.length;c++)n++,e.upload(o[c].uri,function(i){var c=JSON.parse(i.data);0==c.code?(e.imgArray.push(c.data),n==o.length&&(s?(console.log(a(111," at pages/wantBuy/index.vue:430")),t.hideLoading(),t.showToast({icon:"none",title:r}),e.throttle=!1,e.imgArray=e.midImage,e.count=9-e.imgArray.length):(t.hideLoading(),e.throttle=!1,e.count=9-e.imgArray.length))):(s++,r=c.message,console.log(a(n,o.length," at pages/wantBuy/index.vue:449")),n==o.length&&s&&(t.hideLoading(),t.showToast({icon:"none",title:r}),e.throttle=!1,e.imgArray=e.midImage,e.count=9-e.imgArray.length))})})},fail:function(){e.throttle=!1}}))},fail:function(t){e.throttle=!1}}))},cpimgOk:function(e){var i=this,a=0;t.showLoading({title:"上传中"});for(var o=0;o<e.length;o++)a++,this.upload(e[o],function(o){var n=JSON.parse(o.data).data;i.imgArray.push(n),a==e.length&&(t.hideLoading(),i.throttle=!1,i.count=9-i.imgArray.length)})},cpimgErr:function(t){this.throttle=!1},getspecisure:function(){var t=this;this.$myhttp.get(this.websiteUrl+"/categories/"+this.info.id+"/attributes","",function(e){e=e.data.data;t.isSpecifications=e.some(function(t){return t.isRequired}),t.SpecificationsArr=JSON.stringify(e)})},minprice:function(t){this.obj.minPrice=t.target.value,this.obj.maxPrice=t.target.value},areapicshow:function(){this.throttle||(plus.key.hideSoftKeybord(),this.$refs.myCityPicker.show())},onareasure:function(t){var e=this;this.obj.areaId=t.cityCode;var i=(0,c.default)(t.cityCode);this.city=i;var a=i.replace(/-/g,"");this.obj.address=a,this.$myhttp.get(this.websiteUrl+"/geocoder/latlng?address="+encodeURIComponent(a),"",function(t){e.obj.longitude=t.data.location.lng,e.obj.latitude=t.data.location.lat})},showMulLinkageThreePicker:function(t){this.throttle||(plus.key.hideSoftKeybord(),this.purIndex=t,this.$refs.mpvueCityPicker.show())},onConfirm:function(t){this.purchaseList[this.purIndex].name=t.name,t.cityCode?this.purchaseList[this.purIndex].id=t.cityCode:this.purchaseList[this.purIndex].id=null},firstMakeloc:function(t,e){var i=[],a=this.cityname[t],u=this.cityname[e];if(a.parentId!=u.id)for(var d=0;d<o.areas.length;d++)if(o.areas[d].name==t&&o.areas[d].parentId==u.id){a=o.areas[d];break}if(u.parentId)var l=this.areas[u.parentId];else{l=u;u=a}for(var h=n.default.length,f=0;f<h;f++)if(l.id==n.default[f].id){i[0]=f;break}for(var p=s.default[i[0]].length,g=0;g<p;g++)if(u.id==s.default[i[0]][g].id){i[1]=g;break}for(var m=r.default[i[0]][i[1]].length,y=0;y<m;y++)if(a.id==r.default[i[0]][i[1]][y].id){i[2]=y;break}this.obj.areaId=a.id,this.city=(0,c.default)(a.id),this.cityPickerValueDefault=i},getOnloadLaction:function(){var e=this;t.getLocation({type:"gcj02",success:function(t){e.obj.longitude=t.longitude,e.obj.latitude=t.latitude,e.$myhttp.get(e.websiteUrl+"/geocoder/address?lng="+t.longitude+"&lat="+t.latitude,"",function(t){var i=t.data.address_component.district,a=t.data.address_component.city;e.obj.address=t.data.address,e.firstMakeloc(i,a)})},fail:function(){e.$myhttp.get(e.websiteUrl+"/my","",function(t){var i=t.data.data.shop.areaId,a=(0,c.default)(t.data.data.shop.areaId);e.obj.address=a.replace(/-/g,"");var o=e.areas[i];a=e.areas[e.areas[i].parentId];e.firstMakeloc(o.name,a.name),e.$myhttp.get(e.websiteUrl+"/geocoder/latlng?address="+e.obj.address,"",function(t){e.obj.longitude=t.data.location.lng,e.obj.latitude=t.data.location.lat},e)})}})},tospecifica:function(){this.throttle||t.navigateTo({url:"specifications?info="+this.SpecificationsArr})},addPurchaseList:function(){if(!this.throttle){var t=this.purchaseList.length;t>=3||this.purchaseList.push({name:"请选择地区(最多3个)",id:""})}},removePurchaseList:function(t){if(!this.throttle){this.purchaseList.length;this.purchaseList.splice(t,1)}},chooseLocation:function(){var e=this;this.throttle||this.$jurisdiction(function(){t.navigateTo({url:"../components/map?lat="+e.obj.latitude+"&lng="+e.obj.longitude})})},remove:function(e){var i=this;this.throttle||t.showModal({title:"提示",content:"确定要删除么",success:function(t){t.confirm?(i.imgArray.splice(e,1),i.count++):t.cancel&&console.log(a("用户点击取消"," at pages/wantBuy/index.vue:687"))}})},showImg:function(e){this.throttle||t.previewImage({current:0,urls:[e],success:function(t){console.log(a(t," at pages/wantBuy/index.vue:701"))},fail:function(t){console.log(a(t," at pages/wantBuy/index.vue:704"))}})},sures:function(){if(!this.throttle){for(var e=[],i=0;i<this.imgArray.length;i++)e.push(this.imgArray[i].key);if(this.obj.photos=e,!this.isSpecifications||this.obj.specifications)if(this.obj.latitude)if(this.obj.quantity){var a=this.purchaseList.every(function(t){return"请选择地区(最多3个)"==t.name});if(a)t.showToast({icon:"none",title:"至少填写一个采购地区"});else{for(var o=[],n=0;n<this.purchaseList.length;n++)"请选择地区(最多3个)"!==this.purchaseList[n].name&&o.push(this.purchaseList[n].id);this.obj.acceptedAreas=o,this.$myhttp.post(this.websiteUrl+"/purchases",this.obj,function(e){0==e.data.code?t.navigateTo({url:"../release/success?mode=wantbuy"}):t.showToast({title:e.data.message,icon:"none"})})}}else t.showToast({icon:"none",title:"请填写采购数量"});else t.showToast({icon:"none",title:"请填写精确定位"});else t.showToast({icon:"none",title:"请填写规格"})}}}};e.default=p}).call(this,i("6e42")["default"],i("0de9")["default"])},"75e1":function(t,e,i){"use strict";i.r(e);var a=i("70ef"),o=i.n(a);for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);e["default"]=o.a},cc56:function(t,e,i){"use strict";(function(t){i("30b7"),i("921b");a(i("66fd"));var e=a(i("16d8"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("6e42")["createPage"])},f361:function(t,e,i){},f784:function(t,e,i){"use strict";var a=i("f361"),o=i.n(a);o.a}},[["cc56","common/runtime","common/vendor"]]]);