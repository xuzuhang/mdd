(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/wantBuy/offer"],{"26ce":function(t,e,a){},"2ee4":function(t,e,a){"use strict";a.r(e);var o=a("eac3"),i=a.n(o);for(var n in o)"default"!==n&&function(t){a.d(e,t,function(){return o[t]})}(n);e["default"]=i.a},7961:function(t,e,a){"use strict";(function(t){a("30b7"),a("921b");o(a("66fd"));var e=o(a("b61f"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},"7fc4":function(t,e,a){"use strict";var o=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.active=1},t.e1=function(e){t.active=2})},i=[];a.d(e,"a",function(){return o}),a.d(e,"b",function(){return i})},b61f:function(t,e,a){"use strict";a.r(e);var o=a("7fc4"),i=a("2ee4");for(var n in i)"default"!==n&&function(t){a.d(e,t,function(){return i[t]})}(n);a("e91c");var s=a("2877"),r=Object(s["a"])(i["default"],o["a"],o["b"],!1,null,null,null);e["default"]=r.exports},e91c:function(t,e,a){"use strict";var o=a("26ce"),i=a.n(o);i.a},eac3:function(t,e,a){"use strict";(function(t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("90c6"),n=u(a("4efa")),s=u(a("1101")),r=u(a("6372")),c=u(a("ef4f"));function u(t){return t&&t.__esModule?t:{default:t}}var l=function(){return a.e("pages/components/compress").then(a.bind(null,"8d53"))},d=function(){return Promise.all([a.e("common/vendor"),a.e("pages/components/pickcity")]).then(a.bind(null,"f703"))},h=function(){return a.e("pages/components/cpimg/cpimg").then(a.bind(null,"6b9a"))},f={components:{myCityPicker:d,cpimg:h,compress:l},onLoad:function(){var e=this;t.getSystemInfo({success:function(t){e.model=t.platform}}),t.getStorage({key:"purOffer",success:function(t){e.obj=JSON.parse(t.data),e.obj.payTerm?(e.showpay=e.obj.payTerm,e.active=e.obj.payTerm):e.obj.payTerm=1}});for(var a=0;a<i.areas.length;a++)this.areas[i.areas[a].id]=i.areas[a],this.cityname[i.areas[a].name]=i.areas[a]},onReady:function(){this.getOnloadLaction()},onShow:function(){var t=getCurrentPages(),e=t[t.length-1];e.data.objloc&&(this.obj.latitude=e.data.objloc.latitude,this.obj.longitude=e.data.objloc.longitude,this.obj.address=e.data.objloc.address,e.setData({objloc:""}))},data:function(){return{midImage:[],model:"ios",price:"",count:5,throttle:!1,themeColor:"#007AFF",mode:"",deepLength:1,areas:{},cityname:{},cityPickerValueDefault:[0,0,0],city:"",showpay:0,obj:{},imgArray:[],active:1}},methods:{priceInput:function(t){this.price=t.detail.value},toshop:function(){t.navigateTo({url:"../shops/shop?id="+this.obj.userId})},sures:function(){if(!this.throttle)if(!this.obj.requirePhotos||this.price)if(!this.obj.requirePhotos||this.imgArray.length){for(var e=[],a={},o=0;o<this.imgArray.length;o++)e.push(this.imgArray[o].key);a.payTerm=this.active,a.areaId=this.obj.areaId,a.longitude=this.obj.longitude,a.latitude=this.obj.latitude,a.address=this.obj.address,a.price=this.price,a.photos=e,this.$myhttp.post(this.websiteUrl+"/purchases/"+this.obj.id+"/quotations",a,function(e){0==e.data.code?(t.showToast({title:"报价已送达"}),setTimeout(function(){t.navigateBack({delta:1})},500)):t.showToast({icon:"none",title:e.data.message})},this)}else t.showToast({icon:"none",title:"必须带有图片报价哦"});else t.showToast({icon:"none",title:"必须填写价格哦"})},chooseLocation:function(){var e=this;this.throttle||this.$jurisdiction(function(){t.navigateTo({url:"../components/map?lat="+e.obj.latitude+"&lng="+e.obj.longitude})})},showImg:function(e){this.throttle||t.previewImage({current:0,urls:[e],success:function(t){console.log(o(t," at pages/wantBuy/offer.vue:235"))},fail:function(t){console.log(o(t," at pages/wantBuy/offer.vue:238"))}})},remove:function(e){var a=this;this.throttle||t.showModal({title:"提示",content:"确定要删除么",success:function(t){t.confirm?(a.imgArray.splice(e,1),a.count++):t.cancel&&console.log(o("用户点击取消"," at pages/wantBuy/offer.vue:254"))}})},upload:function(e,a){t.uploadFile({url:"https://openapi.hm8848.com/purchases/photos",filePath:e,name:"file",header:{authorization:this.$store.state.token},success:function(t){a(t)},fail:function(e){t.showToast({icon:"none",title:"上传失败"})}})},addPhoto:function(){var e=this;this.throttle||(plus.key.hideSoftKeybord(),this.throttle=!0,t.showActionSheet({itemList:["拍摄","从手机相册中选择"],success:function(a){0==a.tapIndex?t.chooseImage({sizeType:["original"],sourceType:["camera"],success:function(a){e.midImage=e.imgArray,t.getImageInfo({src:a.tempFilePaths[0],success:function(a){var o=0;if("ios"==e.model)o=0;else switch(a.orientation){case"up":o=0;break;case"down":o=180;break;case"right":o=90;break;case"left":o=270;break;default:o=0;break}plus.zip.compressImage({src:a.path,dst:"_doc/uniapp_temp/compressed/"+Math.round(new Date)+".jpg",format:"jpg",quality:90,rotate:o},function(a){t.showLoading({title:"上传中"});var o=a.target;e.upload(o,function(a){var o=JSON.parse(a.data);0==o.code?(e.imgArray.push(o.data),t.hideLoading(),e.throttle=!1,e.count=9-e.imgArray.length):(e.imgArray=e.midImage,e.throttle=!1,t.hideLoading(),t.showToast({icon:"none",title:o.message}))})})}})},fail:function(){e.throttle=!1}}):1==a.tapIndex&&(console.log(o("进入选照片"," at pages/wantBuy/offer.vue:369")),t.chooseImage({count:e.count,sizeType:["original"],sourceType:["album"],success:function(a){e.midImage=e.imgArray,console.log(o(e.midImage," at pages/wantBuy/offer.vue:376")),e.$refs.compress.yasuoImg(a.tempFilePaths).then(function(a){var i=a.map(function(t,e){return{uri:t.tempFilePath}}),n=0,s=0,r="";t.showLoading({title:"上传中"});for(var c=0;c<i.length;c++)n++,e.upload(i[c].uri,function(a){var c=JSON.parse(a.data);0==c.code?(e.imgArray.push(c.data),n==i.length&&(s?(console.log(o(111," at pages/wantBuy/offer.vue:399")),t.hideLoading(),t.showToast({icon:"none",title:r}),e.throttle=!1,e.imgArray=e.midImage,e.count=5-e.imgArray.length):(t.hideLoading(),e.throttle=!1,e.count=5-e.imgArray.length))):(s++,r=c.message,console.log(o(n,i.length," at pages/wantBuy/offer.vue:418")),n==i.length&&s&&(t.hideLoading(),t.showToast({icon:"none",title:r}),e.throttle=!1,e.imgArray=e.midImage,e.count=5-e.imgArray.length))})})},fail:function(){e.throttle=!1}}))},fail:function(t){e.throttle=!1}}))},cpimgOk:function(e){var a=this,o=0;t.showLoading({title:"上传中"});for(var i=0;i<e.length;i++)o++,this.upload(e[i],function(i){var n=JSON.parse(i.data).data;a.imgArray.push(n),o==e.length&&(t.hideLoading(),a.throttle=!1,a.count=5-a.imgArray.length)})},cpimgErr:function(t){this.throttle=!1},areapicshow:function(){this.throttle||(plus.key.hideSoftKeybord(),this.$refs.myCityPicker.show())},onareasure:function(t){var e=this;this.obj.areaId=t.cityCode;var a=(0,c.default)(t.cityCode);this.city=a;var o=a.replace(/-/g,"");this.obj.address=o,this.$myhttp.get(this.websiteUrl+"/geocoder/latlng?address="+encodeURIComponent(o),"",function(t){e.obj.longitude=t.data.location.lng,e.obj.latitude=t.data.location.lat})},getOnloadLaction:function(){var e=this;t.getLocation({type:"gcj02",success:function(t){e.obj.longitude=t.longitude,e.obj.latitude=t.latitude,e.$myhttp.get(e.websiteUrl+"/geocoder/address?lng="+t.longitude+"&lat="+t.latitude,"",function(t){var a=t.data.address_component.district,o=t.data.address_component.city;e.obj.address=t.data.address,e.firstMakeloc(a,o)},e)},fail:function(){e.$myhttp.get(e.websiteUrl+"/my","",function(t){var a=t.data.data.shop.areaId,o=(0,c.default)(t.data.data.shop.areaId);e.obj.address=o.replace(/-/g,"");var i=e.areas[a];o=e.areas[e.areas[a].parentId];e.firstMakeloc(i.name,o.name)},e)}})},firstMakeloc:function(t,e){var a=[],o=this.cityname[t],u=this.cityname[e];if(o.parentId!=u.id)for(var l=0;l<i.areas.length;l++)if(i.areas[l].name==t&&i.areas[l].parentId==u.id){o=i.areas[l];break}if(u.parentId)var d=this.areas[u.parentId];else{d=u;u=o}for(var h=n.default.length,f=0;f<h;f++)if(d.id==n.default[f].id){a[0]=f;break}for(var g=s.default[a[0]].length,p=0;p<g;p++)if(u.id==s.default[a[0]][p].id){a[1]=p;break}for(var m=r.default[a[0]][a[1]].length,y=0;y<m;y++)if(o.id==r.default[a[0]][a[1]][y].id){a[2]=y;break}this.obj.areaId=o.id,this.city=(0,c.default)(o.id),this.cityPickerValueDefault=a}}};e.default=f}).call(this,a("6e42")["default"],a("0de9")["default"])}},[["7961","common/runtime","common/vendor"]]]);