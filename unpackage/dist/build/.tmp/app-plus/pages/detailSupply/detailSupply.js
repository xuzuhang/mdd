(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/detailSupply/detailSupply"],{"18e1":function(t,e,i){"use strict";(function(t,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;i("2585");var o=s(i("5852")),n=s(i("ef4f"));function s(t){return t&&t.__esModule?t:{default:t}}var c={onLoad:function(t){this.id=t.id;try{this.init()}catch(e){this.init()}},data:function(){return{shareStr:"111",shareDetailsDis:!1,stayCall:!0,collection:{ismy:!0,iscollection:!1,timing:!0},id:"",location:"",areas:{},city:"",obj:{birthTime:0,corporateName:"",rank:"",photos:[""],price:"0.00",realName:"",nickName:"",time:"",specificationsArr:[],avatarUrl:"",profile:""},info:{name:"",unit:""},tabactive:1,swipeItem:1,tabBarHeight:"",opcti:0,midIndex:1,indexHeight:{index1:"",index2:"",index3:""}}},onReady:function(){var e=this,i=t.createSelectorQuery().select(".tabBar");i.fields({size:!0},function(t){e.tabBarHeight=t.height}).exec();var a=t.createSelectorQuery().select("#indexes-1");a.fields({size:!0},function(t){e.indexHeight.index1=t.height}).exec();t.createSelectorQuery().select("#indexes-2");a.fields({size:!0},function(t){e.indexHeight.index2=t.height}).exec();t.createSelectorQuery().select("#indexes-3");a.fields({size:!0},function(t){e.indexHeight.index3=t.height}).exec()},methods:{nokaifang:function(){if(!this.$store.state.token)return t.showToast({icon:"none",title:"请登录"}),void setTimeout(function(){t.navigateTo({url:"../login/login1"})},1e3);t.showToast({icon:"none",title:"暂未开放,敬请期待"})},tojubao:function(){t.showToast({icon:"success",title:"举报成功"})},getNumberDay:function(t){var e=new Date(t),i=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate();i=new Date(i),i=i.getTime();var a=(new Date).getTime(),o=a-i,n=Math.ceil(o/1e3/60/60/24);return n},shareDetailsNone:function(){this.shareDetailsDis=!1},shareDetailsShow:function(){this.shareDetailsDis=!0},sharesweixin:function(e){var i=this;t.share({provider:"weixin",scene:e,type:0,title:this.obj.nickName+"的供应 -- "+this.info.name,imageUrl:"https://img.hm8848.com/APP/152x152.png",href:"https://m.miaodadang.com/supplyDetails?id="+this.id,summary:this.shareStr,success:function(t){i.shareDetailsDis=!1,i.$store.state.token&&i.$myhttp.post(i.websiteUrl+"/my/share","",function(t){},i)},fail:function(t){}})},showCall:function(){var e=this;if(!this.$store.state.token)return t.showToast({icon:"none",title:"请登录"}),void setTimeout(function(){t.navigateTo({url:"../login/login1"})},1e3);this.stayCall&&(this.stayCall=!1,this.$myhttp.post(this.websiteUrl+"/my/shops/"+this.obj.userId+"/contact?pay=false","",function(e){console.log(a(e," at pages/detailSupply/detailSupply.vue:400")),t.makePhoneCall({phoneNumber:e.data.data})},this),setTimeout(function(){e.stayCall=!0},1e3))},quxiaoshoucang:function(){var e=this;this.collection.timing&&(this.collection.timing=!1,this.$myhttp.post(this.websiteUrl+"/my/supplies/"+this.id+"/unmark","",function(i){0==i.data.code&&(e.collection.iscollection=!1,t.showToast({title:"取消成功"})),setTimeout(function(){e.collection.timing=!0},500)},this))},toLogin:function(){t.showToast({icon:"none",title:"请登录"}),setTimeout(function(){t.navigateTo({url:"../login/login1"})},1e3)},shoucang:function(){var e=this;this.collection.timing&&(this.$store.state.token?this.collection.ismy?(this.collection.timing=!1,this.$myhttp.post(this.websiteUrl+"/my/supplies/"+this.id+"/mark","",function(i){0==i.data.code&&(e.collection.iscollection=!0,t.showToast({title:"收藏成功"})),setTimeout(function(){e.collection.timing=!0},500)},this)):t.showToast({icon:"none",title:"不能收藏自己的产品!"}):this.toLogin())},getshoucang:function(){var t=this;this.$myhttp.get(this.websiteUrl+"/my/supplies/"+this.id+"/marked","",function(e){t.collection.iscollection=e.data.data},this)},init:function(){var t=this;this.$store.state.token?this.$myhttp.get(this.websiteUrl+"/my","",function(e){var i=e.data.data.user.id;t.$myhttp.get(t.websiteUrl+"/supplies/snapshots/"+t.id,"",function(e){console.log(a(e," at pages/detailSupply/detailSupply.vue:482"));var s=e.data;s.data.userId==i?t.collection.ismy=!1:(t.collection.ismy=!0,t.getshoucang()),t.obj=s.data,t.obj.birthTime=t.getNumberDay(s.data.shopCreateTime),t.obj.price=t.obj.price.toFixed(2),t.obj.time=(0,o.default)(t.obj.refreshTime),t.info=t.$store.state.categories[t.obj.categoryId],t.getlocation();var c=(0,n.default)(s.data.areaId);t.city=c.replace(/-/g,"");var l=[],r=JSON.parse(t.obj.specifications);t.shareStr="";for(var u=0;u<r.length;u++){var h={name:"",value:""},d="",f="";d=r[u].value instanceof Array?r[u].value[0]==r[u].value[1]?r[u].value[0]:r[u].value[0]+d+"-"+r[u].value[1]:r[u].value,r[u].unit&&(f=r[u].unit),h.name=r[u].name,h.value=d+f,l.push(h),t.shareStr+=r[u].name+":"+h.value+";"}t.obj.specificationsArr=l})},this):(this.collection.ismy=!1,this.$http.get(this.websiteUrl+"/supplies/snapshots/"+this.id,"",function(e){console.log(a(e," at pages/detailSupply/detailSupply.vue:534"));var i=e.data;t.obj=i.data,t.obj.price=t.obj.price.toFixed(2),t.obj.time=(0,o.default)(t.obj.refreshTime),t.obj.birthTime=t.getNumberDay(i.data.shopCreateTime),t.info=t.$store.state.categories[t.obj.categoryId],t.getlocation();var s=(0,n.default)(i.data.areaId);t.city=s.replace(/-/g,"");for(var c=[],l=JSON.parse(t.obj.specifications),r=0;r<l.length;r++){var u={name:"",value:""},h="",d="";h=l[r].value instanceof Array?l[r].value[0]+"-"+l[r].value[1]:l[r].value,l[r].unit&&(d=l[r].unit),u.name=l[r].name,u.value=h+d,c.push(u)}t.obj.specificationsArr=c},this))},toshops:function(){if(!this.$store.state.token)return t.showToast({icon:"none",title:"请登录"}),void setTimeout(function(){t.navigateTo({url:"../login/login1"})},1e3);t.navigateTo({url:"../shops/shop?id="+this.obj.userId})},getlocation:function(){var e=this;t.getLocation({type:"gcj02",success:function(t){var i,a,o=e.obj.location.lat*Math.PI/180,n=e.obj.location.lon;a=t.longitude,i=t.latitude*Math.PI/180;var s=o-i,c=n*Math.PI/180-a*Math.PI/180,l=2*Math.asin(Math.sqrt(Math.pow(Math.sin(s/2),2)+Math.cos(o)*Math.cos(i)*Math.pow(Math.sin(c/2),2)));l*=6378.137,l=parseInt(Math.round(1e4*l)/10),e.location=(l/1e3).toFixed(2)+"公里"},fail:function(){e.location=""},complete:function(){}})},showImgs:function(e){t.previewImage({current:e,urls:this.obj.photos})},backs:function(){t.navigateBack({delta:1})},tabchange:function(t){this.midIndex=t,this.tabactive=t},swipeChange:function(t){this.swipeItem=t.detail.current+1},onscroll:function(t){var e=t.target.scrollTop;this.opcti=this.tabBarHeight-e,this.opcti<=0?this.opcti=1:this.opcti<=this.tabBarHeight?this.opcti=e/this.tabBarHeight:this.opcti=0,e>=this.indexHeight.index1-this.tabBarHeight&&(this.tabactive=2),e>=this.indexHeight.index1+this.indexHeight.index2-this.tabBarHeight&&(this.tabactive=3)}}};e.default=c}).call(this,i("6e42")["default"],i("0de9")["default"])},6064:function(t,e,i){},"61a9":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},o=[];i.d(e,"a",function(){return a}),i.d(e,"b",function(){return o})},"99ad":function(t,e,i){"use strict";i.r(e);var a=i("18e1"),o=i.n(a);for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);e["default"]=o.a},c867:function(t,e,i){"use strict";i.r(e);var a=i("61a9"),o=i("99ad");for(var n in o)"default"!==n&&function(t){i.d(e,t,function(){return o[t]})}(n);i("e376");var s=i("2877"),c=Object(s["a"])(o["default"],a["a"],a["b"],!1,null,null,null);e["default"]=c.exports},e376:function(t,e,i){"use strict";var a=i("6064"),o=i.n(a);o.a},fc8e:function(t,e,i){"use strict";(function(t){i("30b7"),i("921b");a(i("66fd"));var e=a(i("c867"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("6e42")["createPage"])}},[["fc8e","common/runtime","common/vendor"]]]);