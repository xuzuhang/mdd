(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/myPurchase/index"],{"0a91":function(e,t,a){"use strict";var i=a("b865"),o=a.n(i);o.a},"5ea2":function(e,t,a){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a("90c6"),s=u(a("4efa")),n=u(a("1101")),r=u(a("6372")),c=u(a("ef4f"));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){return a.e("pages/components/compress").then(a.bind(null,"8d53"))},l=function(){return Promise.all([a.e("common/vendor"),a.e("pages/components/pickallcity")]).then(a.bind(null,"0464"))},h=function(){return Promise.all([a.e("common/vendor"),a.e("pages/components/pickcity")]).then(a.bind(null,"f703"))},f=function(){return a.e("pages/components/cpimg/cpimg").then(a.bind(null,"6b9a"))},p={components:{mpvueCityPicker:l,myCityPicker:h,cpimg:f,compress:d},onLoad:function(t){var a=this;e.getSystemInfo({success:function(e){a.model=e.platform}}),e.getStorage({key:"editorQuotation",success:function(e){var t=JSON.parse(e.data);a.info=t.details,a.id=t.id,a.getspecisure(),a.obj.categoryId=t.categoryId,a.obj.maxPrice=t.maxPrice,a.obj.minPrice=t.minPrice,a.obj.quantity=t.quantity,a.obj.areaId=t.areaId,a.obj.latitude=t.latitude,a.obj.longitude=t.longitude,a.obj.address=t.address,a.obj.profile=t.profile,a.imgArray=t.photos,a.obj.requirePrice=t.requirePrice,a.obj.requirePhotos=t.requirePhotos,t.payTerm&&(a.obj.payTerm=t.payTerm);for(var i=0;i<o.areas.length;i++)a.areas[o.areas[i].id]=o.areas[i],a.cityname[o.areas[i].name]=o.areas[i];a.purchaseList=[];for(var s=0;s<t.acceptedAreas.length;s++){var n={name:"",id:""};if(t.acceptedAreas[s])n={name:(0,c.default)(t.acceptedAreas[s]),id:t.acceptedAreas[s]};else var n={name:"全国",id:null};a.purchaseList.push(n)}var r=a.areas[t.areaId],u=a.areas[r.parentId];a.firstMakeloc(r.name,u.name);for(var d=JSON.parse(t.specifications),l=(n={texts:"",val:[]},0);l<d.length;l++){var h,f={id:d[l].id,value:d[l].value};h=d[l].value instanceof Array?d[l].value[0]+"-"+d[l].value[1]:d[l].value,n.texts+=d[l].name+":"+h+";",n.val.push(f)}a.obj.specifications=JSON.stringify(n.val),a.specificationsVal=n.texts}}),this.newdate()},onShow:function(){var e=getCurrentPages(),t=e[e.length-1];t.data.objloc&&(this.obj.latitude=t.data.objloc.latitude,this.obj.longitude=t.data.objloc.longitude,this.obj.address=t.data.objloc.address,t.setData({objloc:""})),t.data.specifica&&(this.obj.requirePrice=t.data.specifica.requirePrice,this.obj.requirePhotos=t.data.specifica.requirePhotos,this.obj.payTerm=t.data.specifica.payTerm,this.obj.specifications=t.data.specifica.val,this.specificationsVal=t.data.specifica.texts,console.log(i(t.data.specifica," at pages/myPurchase/index.vue:252")),t.setData({specifica:""}))},onReady:function(){this.getOnloadLaction()},data:function(){return{midImage:[],model:"ios",count:9,id:"",valueDate:"",startDate:"",endDate:"",city:"",specificationsVal:"",isSpecifications:!1,SpecificationsArr:"",obj:{categoryId:0,minPrice:"",maxPrice:"",payTerm:"",quantity:"",profile:"",acceptedAreas:[],longitude:0,latitude:0,areaId:"",address:"",photos:[],specifications:"",requirePrice:!1,requirePhotos:!1,expires:""},areas:{},cityname:{},purIndex:1,purchaseList:[{name:"请选择地区(最多3个)",id:""}],info:{},imgArray:[],areapickDefault:[0,0,0],cityPickerValueDefault:[0,0,0],themeColor:"#007AFF",mode:"",deepLength:1}},methods:{changeInput:function(e,t){this.obj[e]=t.target.value},bindDateChange:function(e){this.obj.expires=e.target.value},newdate:function(){var e=new Date,t=e.getTime()+6048e5,a=e.getTime()+15552e6,i=new Date(t),o=new Date(a);this.startDate=i.getFullYear()+"-"+this.addzero(i.getMonth()+1)+"-"+this.addzero(i.getDate()),this.endDate=o.getFullYear()+"-"+this.addzero(o.getMonth()+1)+"-"+this.addzero(o.getDate()),this.obj.expires=this.startDate},addzero:function(e){return e=e>9?e:"0"+e,e},upload:function(t,a){e.uploadFile({url:"https://openapi.hm8848.com/purchases/photos",filePath:t,name:"file",header:{authorization:this.$store.state.token},success:function(e){a(e)},fail:function(t){console.log(i(t," at pages/myPurchase/index.vue:345")),e.showToast({icon:"none",title:"上传失败"})}})},addPhoto:function(){var t=this;this.throttle||(plus.key.hideSoftKeybord(),this.throttle=!0,e.showActionSheet({itemList:["拍摄","从手机相册中选择"],success:function(a){0==a.tapIndex?e.chooseImage({sizeType:["original"],sourceType:["camera"],success:function(a){t.midImage=t.imgArray,e.getImageInfo({src:a.tempFilePaths[0],success:function(a){var i=0;if("ios"==t.model)i=0;else switch(a.orientation){case"up":i=0;break;case"down":i=180;break;case"right":i=90;break;case"left":i=270;break;default:i=0;break}plus.zip.compressImage({src:a.path,dst:"_doc/uniapp_temp/compressed/"+Math.round(new Date)+".jpg",format:"jpg",quality:90,rotate:i},function(a){e.showLoading({title:"上传中"});var i=a.target;t.upload(i,function(a){var i=JSON.parse(a.data);0==i.code?(t.imgArray.push(i.data),e.hideLoading(),t.throttle=!1,t.count=9-t.imgArray.length):(t.imgArray=t.midImage,t.throttle=!1,e.hideLoading(),e.showToast({icon:"none",title:i.message}))})})}})},fail:function(){t.throttle=!1}}):1==a.tapIndex&&(console.log(i("进入选照片"," at pages/myPurchase/index.vue:443")),e.chooseImage({count:t.count,sizeType:["original"],sourceType:["album"],success:function(a){t.midImage=t.imgArray,console.log(i(t.midImage," at pages/myPurchase/index.vue:450")),t.$refs.compress.yasuoImg(a.tempFilePaths).then(function(a){var o=a.map(function(e,t){return{uri:e.tempFilePath}}),s=0,n=0,r="";e.showLoading({title:"上传中"});for(var c=0;c<o.length;c++)s++,t.upload(o[c].uri,function(a){var c=JSON.parse(a.data);0==c.code?(t.imgArray.push(c.data),s==o.length&&(n?(console.log(i(111," at pages/myPurchase/index.vue:473")),e.hideLoading(),e.showToast({icon:"none",title:r}),t.throttle=!1,t.imgArray=t.midImage,t.count=9-t.imgArray.length):(e.hideLoading(),t.throttle=!1,t.count=9-t.imgArray.length))):(n++,r=c.message,console.log(i(s,o.length," at pages/myPurchase/index.vue:492")),s==o.length&&n&&(e.hideLoading(),e.showToast({icon:"none",title:r}),t.throttle=!1,t.imgArray=t.midImage,t.count=9-t.imgArray.length))})})},fail:function(){t.throttle=!1}}))},fail:function(e){t.throttle=!1}}))},cpimgOk:function(t){var a=this,i=0;e.showLoading({title:"上传中"});for(var o=0;o<t.length;o++)i++,this.upload(t[o],function(o){var s=JSON.parse(o.data).data;a.imgArray.push(s),i==t.length&&(e.hideLoading(),a.throttle=!1,a.count=9-a.imgArray.length)})},cpimgErr:function(e){this.throttle=!1},getspecisure:function(){var e=this;this.$myhttp.get(this.websiteUrl+"/categories/"+this.info.id+"/attributes","",function(t){t=t.data.data;e.isSpecifications=t.some(function(e){return e.isRequired}),e.SpecificationsArr=JSON.stringify(t)},this)},minprice:function(e){this.obj.minPrice=e.target.value,this.obj.maxPrice=e.target.value},areapicshow:function(){this.throttle||(plus.key.hideSoftKeybord(),this.$refs.myCityPicker.show())},onareasure:function(e){var t=this;this.obj.areaId=e.cityCode;var a=(0,c.default)(e.cityCode);this.city=a;var i=a.replace(/-/g,"");this.obj.address=i,this.$myhttp.get(this.websiteUrl+"/geocoder/latlng?address="+encodeURIComponent(i),"",function(e){t.obj.longitude=e.data.location.lng,t.obj.latitude=e.data.location.lat},this)},showMulLinkageThreePicker:function(e){this.throttle||(plus.key.hideSoftKeybord(),this.purIndex=e,this.$refs.mpvueCityPicker.show())},onConfirm:function(e){this.purchaseList[this.purIndex].name=e.name,e.cityCode?this.purchaseList[this.purIndex].id=e.cityCode:this.purchaseList[this.purIndex].id=null},firstMakeloc:function(e,t){var a=[],i=this.cityname[e],u=this.cityname[t];if(i.parentId!=u.id)for(var d=0;d<o.areas.length;d++)if(o.areas[d].name==e&&o.areas[d].parentId==u.id){i=o.areas[d];break}if(u.parentId)var l=this.areas[u.parentId];else{l=u;u=i}for(var h=s.default.length,f=0;f<h;f++)if(l.id==s.default[f].id){a[0]=f;break}for(var p=n.default[a[0]].length,g=0;g<p;g++)if(u.id==n.default[a[0]][g].id){a[1]=g;break}for(var m=r.default[a[0]][a[1]].length,v=0;v<m;v++)if(i.id==r.default[a[0]][a[1]][v].id){a[2]=v;break}this.obj.areaId=i.id,this.city=(0,c.default)(i.id),this.cityPickerValueDefault=a},getOnloadLaction:function(){var t=this;e.getLocation({success:function(e){t.obj.longitude=e.longitude,t.obj.latitude=e.latitude,t.$myhttp.get(t.websiteUrl+"/geocoder/address?lng="+e.longitude+"&lat="+e.latitude,"",function(e){var a=e.data.address_component.district,i=e.data.address_component.city;t.obj.address=e.data.address,t.firstMakeloc(a,i)},t)},fail:function(){t.$myhttp.get(t.websiteUrl+"/users","",function(e){var a=e.data.data.areaId,i=(0,c.default)(e.data.data.areaId);t.obj.address=i.replace(/-/g,"");var o=t.areas[a];i=t.areas[t.areas[a].parentId];t.firstMakeloc(o.name,i.name)},t)}})},tospecifica:function(){this.throttle||e.navigateTo({url:"specifications?info="+this.SpecificationsArr})},addPurchaseList:function(){if(!this.throttle){var e=this.purchaseList.length;e>=3||this.purchaseList.push({name:"请选择地区(最多3个)",id:""})}},removePurchaseList:function(e){if(!this.throttle){this.purchaseList.length;this.purchaseList.splice(e,1)}},chooseLocation:function(){var t=this;this.throttle||this.$jurisdiction(function(){e.navigateTo({url:"../components/map?lat="+t.obj.latitude+"&lng="+t.obj.longitude})})},remove:function(t){var a=this;this.throttle||e.showModal({title:"提示",content:"确定要删除么",success:function(e){e.confirm?(a.imgArray.splice(t,1),a.count++):e.cancel&&console.log(i("用户点击取消"," at pages/myPurchase/index.vue:727"))}})},showImg:function(t){this.throttle||e.previewImage({current:0,urls:[t],success:function(e){console.log(i(e," at pages/myPurchase/index.vue:741"))},fail:function(e){console.log(i(e," at pages/myPurchase/index.vue:744"))}})},sures:function(){if(!this.throttle){for(var t=[],a=0;a<this.imgArray.length;a++)t.push(this.imgArray[a].key);if(this.obj.photos=t,!this.isSpecifications||this.obj.specifications)if(this.obj.latitude)if(this.obj.quantity){var o=this.purchaseList.every(function(e){return"请选择地区(最多3个)"==e.name});if(o)e.showToast({icon:"none",title:"至少填写一个采购地区"});else{for(var s=[],n=0;n<this.purchaseList.length;n++)"请选择地区(最多3个)"!==this.purchaseList[n].name&&s.push(this.purchaseList[n].id);this.obj.acceptedAreas=s,this.$myhttp.put(this.websiteUrl+"/purchases/"+this.id,this.obj,function(t){console.log(i(t," at pages/myPurchase/index.vue:805")),0==t.data.code?e.navigateTo({url:"../release/success?mode=wantbuy"}):e.showToast({title:t.data.message,icon:"none"})},this)}}else e.showToast({icon:"none",title:"请填写采购数量"});else e.showToast({icon:"none",title:"请填写精确定位"});else e.showToast({icon:"none",title:"请填写规格"})}}}};t.default=p}).call(this,a("6e42")["default"],a("0de9")["default"])},"897b":function(e,t,a){"use strict";a.r(t);var i=a("ad26"),o=a("a06e");for(var s in o)"default"!==s&&function(e){a.d(t,e,function(){return o[e]})}(s);a("0a91");var n=a("2877"),r=Object(n["a"])(o["default"],i["a"],i["b"],!1,null,null,null);t["default"]=r.exports},a06e:function(e,t,a){"use strict";a.r(t);var i=a("5ea2"),o=a.n(i);for(var s in i)"default"!==s&&function(e){a.d(t,e,function(){return i[e]})}(s);t["default"]=o.a},a5c5:function(e,t,a){"use strict";(function(e){a("30b7"),a("921b");i(a("66fd"));var t=i(a("897b"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},ad26:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement;e._self._c},o=[];a.d(t,"a",function(){return i}),a.d(t,"b",function(){return o})},b865:function(e,t,a){}},[["a5c5","common/runtime","common/vendor"]]]);