(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mySupply/supply"],{"2f13":function(t,e,i){"use strict";i.r(e);var a=i("8cd7"),o=i("b297");for(var s in o)"default"!==s&&function(t){i.d(e,t,function(){return o[t]})}(s);i("5115");var n=i("2877"),r=Object(n["a"])(o["default"],a["a"],a["b"],!1,null,null,null);e["default"]=r.exports},5115:function(t,e,i){"use strict";var a=i("951f"),o=i.n(a);o.a},"87d8":function(t,e,i){"use strict";(function(t,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i("90c6"),s=l(i("ef4f")),n=l(i("4efa")),r=l(i("1101")),c=l(i("6372"));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){return i.e("pages/components/compress").then(i.bind(null,"8d53"))},d=function(){return i.e("pages/components/cpimg/cpimg").then(i.bind(null,"6b9a"))},p=function(){return Promise.all([i.e("common/vendor"),i.e("pages/components/pickcity")]).then(i.bind(null,"f703"))},h={components:{myCityPicker:p,cpimg:d,compress:u},onLoad:function(e){var i=this;t.getSystemInfo({success:function(t){i.model=t.platform}}),t.getStorage({key:"mylistloc",success:function(t){var e=JSON.parse(t.data);console.log(a(e," at pages/mySupply/supply.vue:114")),i.info=e.details,i.id=e.id,i.getspecisure(),i.obj.categoryId=e.categoryId,i.obj.price=e.price,i.obj.quantity=e.quantity,i.obj.areaId=e.areaId,i.obj.latitude=e.latitude,i.obj.longitude=e.longitude,i.obj.address=e.address,i.obj.profile=e.profile,i.imgArray=e.photos;for(var s=0;s<o.areas.length;s++)i.areas[o.areas[s].id]=o.areas[s],i.cityname[o.areas[s].name]=o.areas[s];var n=i.areas[e.areaId],r=i.areas[n.parentId];i.firstMakeloc(n.name,r.name);for(var c=JSON.parse(e.specifications),l={texts:"",val:[]},u=0;u<c.length;u++){var d,p={id:c[u].id,value:c[u].value};d=c[u].value instanceof Array?c[u].value[0]+"-"+c[u].value[1]:c[u].value,l.texts+=c[u].name+":"+d+";",l.val.push(p)}i.obj.specifications=JSON.stringify(l.val),i.specificationsVal=l.texts}}),t.removeStorage({key:"specifications"})},onShow:function(){var t=getCurrentPages(),e=t[t.length-1];e.data.objloc&&(this.obj.latitude=e.data.objloc.latitude,this.obj.longitude=e.data.objloc.longitude,this.obj.address=e.data.objloc.address,e.setData({objloc:""})),e.data.specifica&&(this.obj.specifications=e.data.specifica.val,this.specificationsVal=e.data.specifica.texts,e.setData({specifica:""}))},data:function(){return{cityname:{},cityPickerValueDefault:[0,0,0],themeColor:"#007AFF",midImage:[],model:"ios",count:9,id:"",SpecificationsArr:[],isSpecifications:!1,areas:{},specificationsVal:"",throttle:!1,city:"",dis:!1,info:{unit:"棵",id:31695,name:"",parentId:637,sort:3},imgArray:[],obj:{address:"",title:"",categoryId:"",areaId:"",price:"",quantity:"",profile:"",photos:[],specifications:"",longitude:"",latitude:""}}},methods:{firstMakeloc:function(t,e){var i=[],a=this.cityname[t],l=this.cityname[e];if(a.parentId!=l.id)for(var u=0;u<o.areas.length;u++)if(o.areas[u].name==t&&o.areas[u].parentId==l.id){a=o.areas[u];break}if(l.parentId)var d=this.areas[l.parentId];else{d=l;l=a}for(var p=n.default.length,h=0;h<p;h++)if(d.id==n.default[h].id){i[0]=h;break}for(var f=r.default[i[0]].length,g=0;g<f;g++)if(l.id==r.default[i[0]][g].id){i[1]=g;break}for(var m=c.default[i[0]][i[1]].length,y=0;y<m;y++)if(a.id==c.default[i[0]][i[1]][y].id){i[2]=y;break}this.obj.areaId=a.id,this.city=(0,s.default)(a.id),this.cityPickerValueDefault=i},areapicshow:function(){this.throttle||this.$refs.myCityPicker.show()},onareasure:function(t){var e=this;this.obj.areaId=t.cityCode;var i=(0,s.default)(t.cityCode);this.city=i;var a=i.replace(/-/g,"");this.obj.address=a,this.$myhttp.get(this.websiteUrl+"/geocoder/latlng?address="+encodeURIComponent(a),"",function(t){e.obj.longitude=t.data.location.lng,e.obj.latitude=t.data.location.lat},this)},addPhoto:function(){var e=this;this.throttle||(plus.key.hideSoftKeybord(),this.throttle=!0,t.showActionSheet({itemList:["拍摄","从手机相册中选择"],success:function(i){0==i.tapIndex?t.chooseImage({sizeType:["original"],sourceType:["camera"],success:function(i){e.midImage=e.imgArray,t.getImageInfo({src:i.tempFilePaths[0],success:function(i){var a=0;if("ios"==e.model)a=0;else switch(i.orientation){case"up":a=0;break;case"down":a=180;break;case"right":a=90;break;case"left":a=270;break;default:a=0;break}plus.zip.compressImage({src:i.path,dst:"_doc/uniapp_temp/compressed/"+Math.round(new Date)+".jpg",format:"jpg",quality:90,rotate:a},function(i){t.showLoading({title:"上传中"});var a=i.target;e.upload(a,function(i){var a=JSON.parse(i.data);0==a.code?(e.imgArray.push(a.data),t.hideLoading(),e.throttle=!1,e.count=9-e.imgArray.length):(e.imgArray=e.midImage,e.throttle=!1,t.hideLoading(),t.showToast({icon:"none",title:a.message}))})})}})},fail:function(){e.throttle=!1}}):1==i.tapIndex&&(console.log(a("进入选照片"," at pages/mySupply/supply.vue:381")),t.chooseImage({count:e.count,sizeType:["original"],sourceType:["album"],success:function(i){e.midImage=e.imgArray,console.log(a(e.midImage," at pages/mySupply/supply.vue:388")),e.$refs.compress.yasuoImg(i.tempFilePaths).then(function(i){var o=i.map(function(t,e){return{uri:t.tempFilePath}}),s=0,n=0,r="";t.showLoading({title:"上传中"});for(var c=0;c<o.length;c++)s++,e.upload(o[c].uri,function(i){var c=JSON.parse(i.data);0==c.code?(e.imgArray.push(c.data),s==o.length&&(n?(console.log(a(111," at pages/mySupply/supply.vue:411")),t.hideLoading(),t.showToast({icon:"none",title:r}),e.throttle=!1,e.imgArray=e.midImage,e.count=9-e.imgArray.length):(t.hideLoading(),e.throttle=!1,e.count=9-e.imgArray.length))):(n++,r=c.message,console.log(a(s,o.length," at pages/mySupply/supply.vue:430")),s==o.length&&n&&(t.hideLoading(),t.showToast({icon:"none",title:r}),e.throttle=!1,e.imgArray=e.midImage,e.count=9-e.imgArray.length))})})},fail:function(){e.throttle=!1}}))},fail:function(t){e.throttle=!1}}))},cpimgOk:function(e){var i=this,a=0;t.showLoading({title:"上传中"});for(var o=0;o<e.length;o++)a++,this.upload(e[o],function(o){var s=JSON.parse(o.data).data;i.imgArray.push(s),a==e.length&&(t.hideLoading(),i.throttle=!1,i.count=9-i.imgArray.length)})},cpimgErr:function(t){console.log(a(t," at pages/mySupply/supply.vue:484")),this.throttle=!1},getspecisure:function(){var t=this;this.$myhttp.get(this.websiteUrl+"/categories/"+this.info.id+"/attributes","",function(e){e=e.data.data;t.isSpecifications=e.some(function(t){return t.isRequired}),t.SpecificationsArr=JSON.stringify(e)},this)},sures:function(){for(var e=[],i=0;i<this.imgArray.length;i++)e.push(this.imgArray[i].key);this.obj.photos=e,!this.isSpecifications||this.obj.specifications?this.obj.price?this.obj.areaId?this.obj.photos.length?(console.log(a(this.obj," at pages/mySupply/supply.vue:533")),this.$myhttp.put(this.websiteUrl+"/supplies/"+this.id,this.obj,function(e){0==e.data.code?t.navigateTo({url:"../release/success?mode=supply"}):t.showToast({title:e.data.message,icon:"none"})},this)):t.showToast({icon:"none",title:"请上传至少一张图片"}):t.showToast({icon:"none",title:"请填写供货地区"}):t.showToast({icon:"none",title:"请填写货物价格"}):t.showToast({icon:"none",title:"请填写规格"})},chooseAddres:function(){this.throttle||(plus.key.hideSoftKeybord(),this.dis=!0)},disnone:function(){this.dis=!1},citys:function(t){var e=this;this.obj.areaId=t.id,this.city=t.city,this.obj.address=t.city;var i=this.areas[t.id];this.$myhttp.get(this.websiteUrl+"/geocoder/latlng?address="+i.name,"",function(t){e.obj.longitude=t.data.location.lng,e.obj.latitude=t.data.location.lat},this)},tospecifi:function(){this.throttle||t.navigateTo({url:"specifications?info="+this.SpecificationsArr})},chooseLocation:function(){var e=this;this.throttle||this.$jurisdiction(function(){t.navigateTo({url:"../components/map?lat="+e.obj.latitude+"&lng="+e.obj.longitude})})},remove:function(e){var i=this;t.showModal({title:"提示",content:"确定要删除么",success:function(t){t.confirm?(i.imgArray.splice(e,1),i.count++):t.cancel&&console.log(a("用户点击取消"," at pages/mySupply/supply.vue:602"))}})},showImg:function(e){t.previewImage({current:0,urls:[e],success:function(t){console.log(a(t," at pages/mySupply/supply.vue:613"))},fail:function(t){console.log(a(t," at pages/mySupply/supply.vue:616"))}})},upload:function(e,i){t.uploadFile({url:"https://openapi.hm8848.com/supplies/photos",filePath:e,name:"file",header:{authorization:this.$store.state.token},success:function(t){i(t)},fail:function(){t.showToast({icon:"none",title:"上传失败"})}})}}};e.default=h}).call(this,i("6e42")["default"],i("0de9")["default"])},"8cd7":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},o=[];i.d(e,"a",function(){return a}),i.d(e,"b",function(){return o})},"951f":function(t,e,i){},b297:function(t,e,i){"use strict";i.r(e);var a=i("87d8"),o=i.n(a);for(var s in a)"default"!==s&&function(t){i.d(e,t,function(){return a[t]})}(s);e["default"]=o.a},e05c:function(t,e,i){"use strict";(function(t){i("30b7"),i("921b");a(i("66fd"));var e=a(i("2f13"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("6e42")["createPage"])}},[["e05c","common/runtime","common/vendor"]]]);