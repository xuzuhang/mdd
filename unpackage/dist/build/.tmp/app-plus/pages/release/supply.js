(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/release/supply"],{"1fa6":function(t,e,a){"use strict";var i=a("86df"),o=a.n(i);o.a},"45cd":function(t,e,a){"use strict";a.r(e);var i=a("e270"),o=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=o.a},6800:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},o=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return o})},"6ddb":function(t,e,a){"use strict";(function(t){a("30b7"),a("921b");i(a("66fd"));var e=i(a("d6d8"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},"86df":function(t,e,a){},d6d8:function(t,e,a){"use strict";a.r(e);var i=a("6800"),o=a("45cd");for(var s in o)"default"!==s&&function(t){a.d(e,t,function(){return o[t]})}(s);a("1fa6");var n=a("2877"),r=Object(n["a"])(o["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},e270:function(t,e,a){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a("90c6"),s=l(a("4efa")),n=l(a("1101")),r=l(a("6372")),c=l(a("ef4f"));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){return a.e("pages/components/compress").then(a.bind(null,"8d53"))},d=function(){return a.e("pages/components/cpimg/cpimg").then(a.bind(null,"6b9a"))},f=function(){return Promise.all([a.e("common/vendor"),a.e("pages/components/pickcity")]).then(a.bind(null,"f703"))},h={onBackPress:function(){var e=this;return this.backPress&&t.showModal({title:"您即将关闭发布供应",content:"发布供应”是您生意的开始，只要一分钟，动动手指，就可以让全国的采购商都看到您的供应，这一切都是免费的",cancelText:"继续编辑",confirmText:"暂不发布",success:function(a){a.confirm&&(e.backPress=!1,t.navigateBack({delta:1}))}}),this.backPress},components:{myCityPicker:f,cpimg:d,compress:u},onReady:function(){this.getOnloadLaction()},onLoad:function(e){var a=this;t.getSystemInfo({success:function(t){a.model=t.platform}}),this.info=JSON.parse(e.info),this.obj.categoryId=this.info.id,this.getspecisure();for(var i=0;i<o.areas.length;i++)this.areas[o.areas[i].id]=o.areas[i],this.cityname[o.areas[i].name]=o.areas[i];t.removeStorage({key:"specifications"})},onShow:function(){var t=getCurrentPages(),e=t[t.length-1];e.data.objloc&&(this.obj.latitude=e.data.objloc.latitude,this.obj.longitude=e.data.objloc.longitude,this.obj.address=e.data.objloc.address,e.setData({objloc:""})),e.data.specifica&&(this.obj.specifications=e.data.specifica.val,this.specificationsVal=e.data.specifica.texts,e.setData({specifica:""}))},data:function(){return{midImage:[],model:"ios",count:9,backPress:!0,cityname:{},cityPickerValueDefault:[0,0,0],themeColor:"#007AFF",SpecificationsArr:[],isSpecifications:!1,areas:{},specificationsVal:"",throttle:!1,city:"",dis:!1,info:{unit:"棵",id:31695,name:"白花紫薇",parentId:637,sort:3},imgArray:[],obj:{address:"",title:"",categoryId:"",areaId:"",price:"",quantity:"",profile:"",photos:[],specifications:"",longitude:"",latitude:""},cwidth:0,cheight:0}},methods:{changeInput:function(t,e){this.obj[t]=e.target.value},firstMakeloc:function(t,e){var a=[],i=this.cityname[t],l=this.cityname[e];if(i.parentId!=l.id)for(var u=0;u<o.areas.length;u++)if(o.areas[u].name==t&&o.areas[u].parentId==l.id){i=o.areas[u];break}if(l.parentId)var d=this.areas[l.parentId];else{d=l;l=i}for(var f=s.default.length,h=0;h<f;h++)if(d.id==s.default[h].id){a[0]=h;break}for(var p=n.default[a[0]].length,g=0;g<p;g++)if(l.id==n.default[a[0]][g].id){a[1]=g;break}for(var m=r.default[a[0]][a[1]].length,y=0;y<m;y++)if(i.id==r.default[a[0]][a[1]][y].id){a[2]=y;break}this.obj.areaId=i.id,this.city=(0,c.default)(i.id),this.cityPickerValueDefault=a},getOnloadLaction:function(){var e=this;t.getLocation({type:"gcj02",success:function(t){e.obj.longitude=t.longitude,e.obj.latitude=t.latitude,e.$myhttp.get(e.websiteUrl+"/geocoder/address?lng="+t.longitude+"&lat="+t.latitude,"",function(t){var a=t.data.address_component.district,i=t.data.address_component.city;e.obj.address=t.data.address,e.firstMakeloc(a,i)},e)},fail:function(){e.$myhttp.get(e.websiteUrl+"/my","",function(t){console.log(i(t," at pages/release/supply.vue:274"));var a=t.data.data.shop.areaId,o=(0,c.default)(t.data.data.shop.areaId);e.obj.address=o.replace(/-/g,"");var s=e.areas[a];o=e.areas[e.areas[a].parentId];e.firstMakeloc(s.name,o.name),e.$myhttp.get(e.websiteUrl+"/geocoder/latlng?address="+encodeURIComponent(e.obj.address),"",function(t){e.obj.longitude=t.data.location.lng,e.obj.latitude=t.data.location.lat},e)},e)}})},areapicshow:function(){this.throttle||this.$refs.myCityPicker.show()},onareasure:function(t){var e=this;this.obj.areaId=t.cityCode;var a=(0,c.default)(t.cityCode);this.city=a;var i=a.replace(/-/g,"");this.obj.address=i,this.$myhttp.get(this.websiteUrl+"/geocoder/latlng?address="+i,"",function(t){e.obj.longitude=t.data.location.lng,e.obj.latitude=t.data.location.lat},this)},addPhoto:function(){var e=this;this.throttle||(plus.key.hideSoftKeybord(),this.throttle=!0,t.showActionSheet({itemList:["拍摄","从手机相册中选择"],success:function(a){0==a.tapIndex?t.chooseImage({sizeType:["original"],sourceType:["camera"],success:function(a){e.midImage=e.imgArray,t.getImageInfo({src:a.tempFilePaths[0],success:function(a){var i=0;if("ios"==e.model)i=0;else switch(a.orientation){case"up":i=0;break;case"down":i=180;break;case"right":i=90;break;case"left":i=270;break;default:i=0;break}plus.zip.compressImage({src:a.path,dst:"_doc/uniapp_temp/compressed/"+Math.round(new Date)+".jpg",format:"jpg",quality:90,rotate:i},function(a){t.showLoading({title:"上传中"});var i=a.target;e.upload(i,function(a){var i=JSON.parse(a.data);0==i.code?(e.imgArray.push(i.data),t.hideLoading(),e.throttle=!1,e.count=9-e.imgArray.length):(e.imgArray=e.midImage,e.throttle=!1,t.hideLoading(),t.showToast({icon:"none",title:i.message}))})})}})},fail:function(){e.throttle=!1}}):1==a.tapIndex&&(console.log(i("进入选照片"," at pages/release/supply.vue:396")),t.chooseImage({count:e.count,sizeType:["original"],sourceType:["album"],success:function(a){e.midImage=e.imgArray,console.log(i(e.midImage," at pages/release/supply.vue:403")),e.$refs.compress.yasuoImg(a.tempFilePaths).then(function(a){var o=a.map(function(t,e){return{uri:t.tempFilePath}}),s=0,n=0,r="";t.showLoading({title:"上传中"});for(var c=0;c<o.length;c++)s++,e.upload(o[c].uri,function(a){var c=JSON.parse(a.data);0==c.code?(e.imgArray.push(c.data),s==o.length&&(n?(console.log(i(111," at pages/release/supply.vue:426")),t.hideLoading(),t.showToast({icon:"none",title:r}),e.throttle=!1,e.imgArray=e.midImage,e.count=9-e.imgArray.length):(t.hideLoading(),e.throttle=!1,e.count=9-e.imgArray.length))):(n++,r=c.message,console.log(i(s,o.length," at pages/release/supply.vue:445")),s==o.length&&n&&(t.hideLoading(),t.showToast({icon:"none",title:r}),e.throttle=!1,e.imgArray=e.midImage,e.count=9-e.imgArray.length))})})},fail:function(){e.throttle=!1}}))},fail:function(t){e.throttle=!1}}))},cpimgOk:function(e){var a=this,i=0;t.showLoading({title:"上传中"});for(var o=0;o<e.length;o++)i++,this.upload(e[o],function(o){var s=JSON.parse(o.data).data;a.imgArray.push(s),i==e.length&&(t.hideLoading(),a.throttle=!1,a.count=9-a.imgArray.length)})},cpimgErr:function(t){console.log(i(t," at pages/release/supply.vue:499")),this.throttle=!1},getspecisure:function(){var t=this;this.$myhttp.get(this.websiteUrl+"/categories/"+this.info.id+"/attributes","",function(e){e=e.data.data;t.isSpecifications=e.some(function(t){return t.isRequired}),t.SpecificationsArr=JSON.stringify(e)},this)},sures:function(){for(var e=[],a=0;a<this.imgArray.length;a++)e.push(this.imgArray[a].key);this.obj.photos=e,!this.isSpecifications||this.obj.specifications?this.obj.price?this.obj.areaId?this.obj.photos.length?this.$myhttp.post(this.websiteUrl+"/supplies",this.obj,function(e){0==e.data.code?t.navigateTo({url:"success?mode=supply"}):t.showToast({title:e.data.message,icon:"none"})},this):t.showToast({icon:"none",title:"请上传至少一张图片"}):t.showToast({icon:"none",title:"请填写供货地区"}):t.showToast({icon:"none",title:"请填写货物价格"}):t.showToast({icon:"none",title:"请填写规格"})},tospecifi:function(){this.throttle||t.navigateTo({url:"specifications?info="+this.SpecificationsArr})},chooseLocation:function(){var e=this;this.throttle||this.$jurisdiction(function(){t.navigateTo({url:"../components/map?lat="+e.obj.latitude+"&lng="+e.obj.longitude})})},remove:function(e){var a=this;t.showModal({title:"提示",content:"确定要删除么",success:function(t){t.confirm?(a.imgArray.splice(e,1),a.count++):t.cancel&&console.log(i("用户点击取消"," at pages/release/supply.vue:590"))}})},showImg:function(e){t.previewImage({current:0,urls:[e],success:function(t){console.log(i(t," at pages/release/supply.vue:601"))},fail:function(t){console.log(i(t," at pages/release/supply.vue:604"))}})},upload:function(e,a){t.uploadFile({url:"https://openapi.hm8848.com/supplies/photos",filePath:e,name:"file",header:{authorization:this.$store.state.token},success:function(t){a(t)},fail:function(e){console.log(i(e," at pages/release/supply.vue:621")),t.showToast({icon:"none",title:"上传失败"})}})}}};e.default=h}).call(this,a("6e42")["default"],a("0de9")["default"])}},[["6ddb","common/runtime","common/vendor"]]]);